<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>CFSSL Cloudflare SSL</title>
    <meta name="description" content="A Caffeinated Java Developer." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="https://johnyeary.com//2018-05-25-cfssl-cloudflare-ssl.html" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="John Yeary" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="CFSSL Cloudflare SSL" />
    <meta property="og:description" content="A Caffeinated Java Developer." />
    <meta property="og:url" content="https://johnyeary.com//2018-05-25-cfssl-cloudflare-ssl.html" />
    <meta property="og:image" content="/assets/images/door-green-closed-lock.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="CFSSL Cloudflare SSL" />
    <meta name="twitter:description" content="A Caffeinated Java Developer." />
    <meta name="twitter:url" content="https://johnyeary.com//2018-05-25-cfssl-cloudflare-ssl.html" />
    <meta name="twitter:image:src" content="/assets/images/door-green-closed-lock.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "John Yeary",
    "name": "CFSSL Cloudflare SSL",
    "url": "https://johnyeary.com//2018-05-25-cfssl-cloudflare-ssl.html",
    "image": "/assets/images/door-green-closed-lock.jpg",
    "description": "A Caffeinated Java Developer."
}
    </script>

    <meta name="generator" content="Jekyll 4.0.0" />
    <link rel="alternate" type="application/rss+xml" title="John Yeary" href="/feed.xml" />

    <!-- Add Google Analytics  -->
         <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-4194623-5', 'auto');
	    ga('send', 'pageview');
     </script>

</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!--
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        -->
        <li class="nav-java " role="presentation"><a href="/tag/java">Java</a></li>
        <li class="nav-life " role="presentation"><a href="/tag/life">Life</a></li>
        <li class="nav-mac " role="presentation"><a href="/tag/mac">Mac</a></li>
        <li class="nav-merchant-marine " role="presentation"><a href="/tag/merchant-marine">Merchant Marine</a></li>
        <li class="nav-military " role="presentation"><a href="/tag/military">Military</a></li>
        <li class="nav-national-security " role="presentation"><a href="/tag/national-security">National Security</a></li>
        <li class="nav-sailing " role="presentation"><a href="/tag/sailing">Sailing</a></li>
        <li class="nav-unix " role="presentation"><a href="/tag/unix">UNIX</a></li>
        <li class="nav-web " role="presentation"><a href="/tag/web">Web</a></li>
        <li class="nav-yoga " role="presentation"><a href="/tag/yoga">Yoga</a></li>
        <li class="nav-author " role="presentation"><a href="/author/jyeary">John Yeary</a></li>
        <!--
        <li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>
        <li class="nav-author " role="presentation"><a href="/author/casper">Casper</a></li>
        <li class="nav-author " role="presentation"><a href="/author/edgar">Edgar</a></li>
        <li class="nav-author " role="presentation"><a href="/author/abraham">Abraham</a></li>
        <li class="nav-author " role="presentation"><a href="/author/martin">Martin</a></li>
        <li class="nav-author " role="presentation"><a href="/author/lewis">Lewis</a></li>
        -->
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/door-green-closed-lock.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/logo.jpg" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-web">

        <header class="post-header">
            <h1 class="post-title">CFSSL Cloudflare SSL</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/jyeary'>John Yeary</a>
                
            
            <time class="post-date" datetime="2018-05-25">25 May 2018</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/web'>Web</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>A normal devops activity is installing certificates on your servers. However, most servers if used internally don’t need an official CA signed certificate for normal operations. Especially when dealing with development machines, or testing. So why pay the man… when you can be the man! Be your own CA!</p>

<h3 id="cloudflare-ssl-cfssl">Cloudflare SSL (cfssl)</h3>
<p>Cloudflare open-sourced their cfssl software under a BSD license. It is written in go, and offers a number of great features. However, like any number of open-source projects, it lacks really good documentation. The software works great once you get it figured out. Let me try to show you how I set up my configuration.</p>

<h4 id="bootstrap-instructions">Bootstrap Instructions</h4>
<ol>
  <li>Create a Certificate Authority (CA) Certificate Signing Request (CSR). This is the file used to generate our CA name, keys, and generate our own CSR (if we want it signed by another CA). Here is an example <strong>ca_csr.json</strong>.
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"CN"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Internal CA"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"algo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"L"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Greenville"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"O"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Charlie Company"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"OU"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OPS"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"ST"</span><span class="p">:</span><span class="w"> </span><span class="s2">"South Carolina"</span><span class="w">
 </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Generate your public and private keys, and a CSR for signing by a third party if necessary.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -initca csr_ca.json | cfssljson -bare ca
</code></pre></div>    </div>
  </li>
  <li>Create your configuration file <strong>ca_config.json</strong>. My version differs from the first reference listed below. You will need to provide your own key. Here is an online resource to generate one: <a href="https://www.random.org/bytes/">Random Byte Generator</a>
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"signing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"auth_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key1"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8760h"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"usages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
       </span><span class="s2">"signing"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"key encipherment"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"server auth"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"cert sign"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"crl sign"</span><span class="p">,</span><span class="w">
       </span><span class="s2">"client auth"</span><span class="w">
     </span><span class="p">]</span><span class="w">
   </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"auth_keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="err">&lt;</span><span class="mi">16</span><span class="w"> </span><span class="err">byte</span><span class="w"> </span><span class="err">hex</span><span class="w"> </span><span class="err">API</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">here&gt;</span><span class="w"> </span><span class="p">,</span><span class="w">
   </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"standard"</span><span class="w">
 </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Start your server:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl serve -ca-key ca-key.pem -ca ca.pem -config config_ca.json
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="generating-and-signing-certificates">Generating and Signing Certificates</h3>
<p><strong>Note:</strong> The server name in this example is called <em>groot</em>, as in, <em>I am Groot!</em> from the movie <em>Guardians of the Galaxy</em>.</p>

<ol>
  <li>Create Create a <strong>csr_client.json</strong>. This contains the information for the server for which we want create a certificate.
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"CN"</span><span class="p">:</span><span class="w"> </span><span class="s2">"groot.example.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"hosts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
   </span><span class="s2">"iamgroot.example.com"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"*.example.com"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"algo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rsa"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">2048</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
 </span><span class="p">{</span><span class="w">
   </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"L"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Greenville"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"O"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Charlie Company"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"OU"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OPS"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"ST"</span><span class="p">:</span><span class="w"> </span><span class="s2">"South Carolina"</span><span class="w">
 </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>Create a <strong>config_client.json</strong>. This contains the information required to connect to our new server.
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"signing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"auth_remote"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"auth_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key1"</span><span class="p">,</span><span class="w">
   </span><span class="nl">"remote"</span><span class="p">:</span><span class="w"> </span><span class="s2">"caserver"</span><span class="w">
 </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"auth_keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"key1"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;16 byte hex API key here. Same key as server.&gt;"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"standard"</span><span class="w">
 </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"remotes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="nl">"caserver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"127.0.0.1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>The command below will generate the key (<strong>groot-key.pem</strong>), and CSR (<strong>groot.csr</strong>). Then it will use the provided configuration to contact the server and return the signed certificate. The certificate will be called <strong>groot.pem</strong>.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl gencert -config config_client.json csr_client.json | cfssljson -bare groot
</code></pre></div>    </div>
  </li>
  <li>(ALTERNATIVE) If you already have a CSR, you can request that the server sign it. This will provide a certificate called <strong>groot.pem</strong>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl sign -config config_client.json groot.csr | cfssljson -bare groot
</code></pre></div>    </div>
  </li>
  <li>(ALTERNATIVE) If you need additional host names, e.g, Subject Alternative Name (SAN), you can use the following command substituting hostnames below with comma separated values.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfssl sign -config config_client.json -hostname=quill.example.com,ronan.example.com,kree.example.com groot.csr | cfssljson -bare groot
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="references">References</h3>
<ul>
  <li><a href="https://blog.cloudflare.com/how-to-build-your-own-public-key-infrastructure/">How to build your own public key infrastructure</a></li>
  <li><a href="https://github.com/cloudflare/cfssl">cloudflare/cfssl</a></li>
  <li><a href="https://github.com/cloudflare/cfssl/issues/566">steps in bootstrap.txt not working #566</a></li>
</ul>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/jyeary" style="background-image: url(/assets/images/jyeary.jpg)"><span class="hidden">jyeary's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/jyeary">John Yeary</a></h4>

                        
                            <p> Caffeinated Java Programmer, and Principal Software Engineer at Orange Bees. My opinions are my own.</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Greenville, South Carolina, USA</span>
                            <span class="author-link icon-link"><a href="https://johnyeary.com/author/jyeary/"> johnyeary.com</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="https://twitter.com/share?text=CFSSL Cloudflare SSL&amp;url=https://johnyeary.com/2018-05-25-cfssl-cloudflare-ssl.html"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://johnyeary.com/2018-05-25-cfssl-cloudflare-ssl.html"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <!--
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=https://johnyeary.com2018-05-25-cfssl-cloudflare-ssl.html"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                        -->
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'john-yeary'; // required: replace example with your forum shortname
    var disqus_identifier = '/2018-05-25-cfssl-cloudflare-ssl.html';
    var disqus_url = 'https://johnyeary.com/2018-05-25-cfssl-cloudflare-ssl.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
        Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/pexels-photo-209137.jpeg)" href="/2018-06-29-apache-commons-io-directory-copying.html">
            <section class="post">
                <h2>Apache Commons IO Directory Copying</h2>
                <p>### Introduction I was having an issue with some code in a very large project,...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/brown-landscape-under-grey-sky-3244513.jpg)" href="/2018-05-18-disabling-and-enabling-hyper-v-on-windows.html">
            <section class="post">
                <h2>Disabling and Enabling Hyper-V on Windows</h2>
                <p>I needed to be able to run VMWare and VirtualBox from my Windows 10 Pro...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">John Yeary</a> &copy; 2021</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
