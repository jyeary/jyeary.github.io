<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Mercurial 4.5+ as a Windows Service</title>
    <meta name="description" content="A Caffeinated Java Developer." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="https://johnyeary.com//2018-05-16-mercurial-4-5-as-a-windows-service.html" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="John Yeary" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Mercurial 4.5+ as a Windows Service" />
    <meta property="og:description" content="A Caffeinated Java Developer." />
    <meta property="og:url" content="https://johnyeary.com//2018-05-16-mercurial-4-5-as-a-windows-service.html" />
    <meta property="og:image" content="/assets/images/pexels-photo-963635.jpeg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Mercurial 4.5+ as a Windows Service" />
    <meta name="twitter:description" content="A Caffeinated Java Developer." />
    <meta name="twitter:url" content="https://johnyeary.com//2018-05-16-mercurial-4-5-as-a-windows-service.html" />
    <meta name="twitter:image:src" content="/assets/images/pexels-photo-963635.jpeg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "John Yeary",
    "name": "Mercurial 4.5+ as a Windows Service",
    "url": "https://johnyeary.com//2018-05-16-mercurial-4-5-as-a-windows-service.html",
    "image": "/assets/images/pexels-photo-963635.jpeg",
    "description": "A Caffeinated Java Developer."
}
    </script>

    <meta name="generator" content="Jekyll 4.0.0" />
    <link rel="alternate" type="application/rss+xml" title="John Yeary" href="/feed.xml" />

    <!-- Add Google Analytics  -->
         <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-4194623-5', 'auto');
	    ga('send', 'pageview');
     </script>

</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <!--
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        -->
        <li class="nav-java " role="presentation"><a href="/tag/java">Java</a></li>
        <li class="nav-life " role="presentation"><a href="/tag/life">Life</a></li>
        <li class="nav-mac " role="presentation"><a href="/tag/mac">Mac</a></li>
        <li class="nav-merchant-marine " role="presentation"><a href="/tag/merchant-marine">Merchant Marine</a></li>
        <li class="nav-military " role="presentation"><a href="/tag/military">Military</a></li>
        <li class="nav-national-security " role="presentation"><a href="/tag/national-security">National Security</a></li>
        <li class="nav-sailing " role="presentation"><a href="/tag/sailing">Sailing</a></li>
        <li class="nav-unix " role="presentation"><a href="/tag/unix">UNIX</a></li>
        <li class="nav-web " role="presentation"><a href="/tag/web">Web</a></li>
        <li class="nav-yoga " role="presentation"><a href="/tag/yoga">Yoga</a></li>
        <li class="nav-author " role="presentation"><a href="/author/jyeary">John Yeary</a></li>
        <!--
        <li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>
        <li class="nav-author " role="presentation"><a href="/author/casper">Casper</a></li>
        <li class="nav-author " role="presentation"><a href="/author/edgar">Edgar</a></li>
        <li class="nav-author " role="presentation"><a href="/author/abraham">Abraham</a></li>
        <li class="nav-author " role="presentation"><a href="/author/martin">Martin</a></li>
        <li class="nav-author " role="presentation"><a href="/author/lewis">Lewis</a></li>
        -->
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/pexels-photo-963635.jpeg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/logo.jpg" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-web">

        <header class="post-header">
            <h1 class="post-title">Mercurial 4.5+ as a Windows Service</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/jyeary'>John Yeary</a>
                
            
            <time class="post-date" datetime="2018-05-16">16 May 2018</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/web'>Web</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <h3 id="requirements">Requirements:</h3>
<ul>
  <li><a href="https://www.python.org/downloads/release/python-2715/">Python 2.7.15</a></li>
  <li><a href="https://www.mercurial-scm.org/downloads">Mercurial 4.5.3</a> (source install)</li>
  <li><a href="https://github.com/kohsuke/winsw/releases">winsw-v2.1.2</a> (Please select the version according to .Net version installed on your platform)</li>
</ul>

<h3 id="python">Python</h3>
<p>I used the MSI installer for Python. It works perfectly fine, and can be used in a headless environment like Windows Server Core if you need to install it in a headless environment.</p>

<h3 id="mercurial">Mercurial</h3>
<p>I used the Mercurial source install. This places the software within the Python installation. This makes it easier for applications to find it. If you use an installer like the Windows MSI, it will place the application in a different location such as <code class="language-plaintext highlighter-rouge">C\Program Files</code></p>

<p>I needed to be able to create a Windows Service for Mercurial. Unfortunately, there is no built-in functionality in the Mercurial Downloads, not even for Windows installers (.msi) files. This is not the end of the world. There are commercial products that you can purchase to accomplish this. In my day job, we have such a contract for one of those products. In the world of open source though we expect that we are not the first person to encounter such an issue. Fortunately, there is a great project called <a href="https://github.com/kohsuke/winsw">WinSW</a>. Kohsuke one of the original authors of Jenkins developed this code for use in that project, and released it for public consumption.</p>

<h3 id="winsw">WinSW</h3>
<p><a href="https://github.com/kohsuke/winsw">WinSW</a> is one of the easiest software applications to use to make Windows services. You download the application, and rename it to whatever you  like. In this example, I used <code class="language-plaintext highlighter-rouge">hg-service.exe</code> since that made the most sense to me. The configuration file that is used must match the name of the service. That makes a lot of sense too. The WinSW software examines its own name, and looks for a configuration file with the same name and an .xml extension. You can see this in the example below.</p>

<p><img src="https://storage.googleapis.com/methodical-kaleidoscope-7367/2018/05/files.png" alt="Mercurial files" /></p>

<h3 id="installation-and-configuration">Installation and Configuration</h3>
<ol>
  <li>Create a directory called <code class="language-plaintext highlighter-rouge">hg-service</code>.</li>
  <li>Add the <a href="https://github.com/kohsuke/winsw">winsw</a> file of your choice based on your .NET framework.</li>
  <li>Rename the winsw file to <code class="language-plaintext highlighter-rouge">hg-service.exe</code>.</li>
  <li>Add a blank <code class="language-plaintext highlighter-rouge">hg-service.xml</code> file. We will add details to it in a moment.</li>
  <li>Add a blank <code class="language-plaintext highlighter-rouge">hg-service.bat</code> file. We will add details to it in a moment.</li>
</ol>

<h4 id="hg-servicebat">hg-service.bat</h4>

<p>Copy the following into the <code class="language-plaintext highlighter-rouge">hg-service.bat</code> file.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@echo off
<span class="k">if</span> <span class="s2">"%1"</span><span class="o">==</span><span class="s2">"start"</span> <span class="o">(</span>goto :start<span class="o">)</span>
:stop
taskkill /F /IM hg.exe /T
goto :end
:start
REM <span class="s2">"C:</span><span class="se">\P</span><span class="s2">ython27</span><span class="se">\S</span><span class="s2">cripts</span><span class="se">\h</span><span class="s2">g.exe"</span> serve <span class="nt">--address</span> localhost <span class="nt">--port</span> 8000 <span class="nt">--web-conf</span> C:<span class="se">\h</span>g<span class="se">\h</span>gweb.config
REM The configuration below will start the service on all addresses on the machine 0.0.0.0 on port 8000 by default
<span class="s2">"C:</span><span class="se">\P</span><span class="s2">ython27</span><span class="se">\S</span><span class="s2">cripts</span><span class="se">\h</span><span class="s2">g.exe"</span> serve <span class="nt">--web-conf</span> C:<span class="se">\h</span>g<span class="se">\h</span>gweb.config
:end
</code></pre></div></div>
<h4 id="hg-servicexml">hg-service.xml</h4>
<p>Copy the following into the <code class="language-plaintext highlighter-rouge">hg-service.xml</code> file. The details should be self-explanatory. If you need more details on the configuration file, please look at this post: <a href="https://github.com/kohsuke/winsw/blob/master/doc/xmlConfigFile.md">WinSW XML Configuration File</a></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;service&gt;</span>
    <span class="nt">&lt;id&gt;</span>hg-serve<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;name&gt;</span>Mercurial<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>Mercurial Web Server.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;executable&gt;</span>cmd.exe<span class="nt">&lt;/executable&gt;</span>
    <span class="nt">&lt;startargument&gt;</span>/c<span class="nt">&lt;/startargument&gt;</span>
    <span class="nt">&lt;startargument&gt;</span>C:\hg\hg-service.bat<span class="nt">&lt;/startargument&gt;</span>
    <span class="nt">&lt;startargument&gt;</span>start<span class="nt">&lt;/startargument&gt;</span>
    <span class="nt">&lt;stopexecutable&gt;</span>cmd.exe<span class="nt">&lt;/stopexecutable&gt;</span>
    <span class="nt">&lt;stopargument&gt;</span>/c<span class="nt">&lt;/stopargument&gt;</span>
    <span class="nt">&lt;stopargument&gt;</span>C:\hg\hg-service.bat<span class="nt">&lt;/stopargument&gt;</span>
    <span class="nt">&lt;stopargument&gt;</span>stop<span class="nt">&lt;/stopargument&gt;</span>
    <span class="nt">&lt;logmode&gt;</span>rotate<span class="nt">&lt;/logmode&gt;</span>
    <span class="nt">&lt;logpath&gt;</span>C:\hg\logs<span class="nt">&lt;/logpath&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</code></pre></div></div>
<h4 id="hgwebconfig">hgweb.config</h4>
<p>Finally we need a configuration file that contains information about the repositories we want to serve. Here is an example configuration.</p>
<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[web]</span>
<span class="py">encoding</span> <span class="p">=</span> <span class="s">UTF-8</span>
<span class="py">allow_push</span> <span class="p">=</span> <span class="s">*</span>
<span class="py">push_ssl</span> <span class="p">=</span> <span class="s">false</span>
<span class="py">contact</span> <span class="p">=</span> <span class="s">John Yeary</span>
<span class="py">allow_archive</span> <span class="p">=</span> <span class="s">gz zip bz2</span>
<span class="py">descend</span> <span class="p">=</span> <span class="s">True</span>
<span class="py">collapse</span> <span class="p">=</span> <span class="s">True</span>
<span class="py">style</span><span class="p">=</span><span class="s">gitweb</span>

<span class="nn">[paths]</span>
<span class="c"># Directory Search (Slow)
#/ = C:\repos\*
</span><span class="py">foo</span> <span class="p">=</span> <span class="s">C:</span><span class="se">\r</span><span class="s">epos</span><span class="se">\f</span><span class="s">oo</span>
</code></pre></div></div>

<p>This completes our installation as a service. As you can see our <strong>Foo</strong> is being served…</p>
<figure class="image">
    <img src="https://storage.googleapis.com/methodical-kaleidoscope-7367/2018/05/ServiceRunning.png" alt="Mercurial Service Running" />
    <figcaption>Mercurial Service Running</figcaption>
</figure>

<figure class="image">
    <img src="https://storage.googleapis.com/methodical-kaleidoscope-7367/2018/05/FooMagick.png" alt="Mercurial Directory Listing" />
    <figcaption>Mercurial Directory Listing</figcaption>
</figure>

<p>The configuration files for this project are located here: <strong><a href="https://storage.googleapis.com/methodical-kaleidoscope-7367/2018/05/hg-service.zip">hg-service.zip</a></strong></p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/jyeary" style="background-image: url(/assets/images/jyeary.jpg)"><span class="hidden">jyeary's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/jyeary">John Yeary</a></h4>

                        
                            <p> Caffeinated Java Programmer, and Java Software Architect at Orange Bees. My opinions are my own.</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Greenville, South Carolina, USA</span>
                            <span class="author-link icon-link"><a href="https://johnyeary.com/author/jyeary/"> johnyeary.com</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="https://twitter.com/share?text=Mercurial 4.5+ as a Windows Service&amp;url=https://johnyeary.com/2018-05-16-mercurial-4-5-as-a-windows-service.html"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://johnyeary.com/2018-05-16-mercurial-4-5-as-a-windows-service.html"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <!--
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=https://johnyeary.com2018-05-16-mercurial-4-5-as-a-windows-service.html"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                        -->
                    </section>
                
            

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'john-yeary'; // required: replace example with your forum shortname
    var disqus_identifier = '/2018-05-16-mercurial-4-5-as-a-windows-service.html';
    var disqus_url = 'https://johnyeary.com/2018-05-16-mercurial-4-5-as-a-windows-service.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
        Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/pexels-photo-158935.jpeg)" href="/2018-05-18-nginx-mercurial-proxy-on-windows.html">
            <section class="post">
                <h2>NGINX Mercurial Proxy on Windows</h2>
                <p>In my previous article I explained how to setup [Mercurial 4.5+ as a Windows Service](/2018-05-16-mercurial-4-5-as-a-windows-service.html)....</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/Wireshark_on_Xpra_Docker.png)" href="/2018-03-13-qwiklabs-network-performance-testing-lab.html">
            <section class="post">
                <h2>Qwiklabs Network Performance Testing Lab</h2>
                <p>I completed the Qwiklabs Network Performance Testing Lab for Google Cloud Networking. In the lab,...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">John Yeary</a> &copy; 2024</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
